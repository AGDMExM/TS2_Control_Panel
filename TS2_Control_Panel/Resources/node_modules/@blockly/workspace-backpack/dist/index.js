/*! For license information please see index.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],e);else{var o="object"==typeof exports?e(require("blockly/core")):e(t.Blockly);for(var s in o)("object"==typeof exports?exports:t)[s]=o[s]}}(this,(function(t){return(()=>{"use strict";var e={573:e=>{e.exports=t}},o={};function s(t){var n=o[t];if(void 0!==n)return n.exports;var i=o[t]={exports:{}};return e[t](i,i.exports,s),i.exports}s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};return(()=>{s.r(n),s.d(n,{BACKPACK_CHANGE:()=>i,BACKPACK_OPEN:()=>e,Backpack:()=>c,BackpackChange:()=>r,BackpackContextMenuOptions:()=>{},BackpackOpen:()=>o,BackpackOptions:()=>{}});var t=s(573);t.Msg.COPY_ALL_TO_BACKPACK="Copy All Blocks to Backpack",t.Msg.COPY_TO_BACKPACK="Copy to Backpack",t.Msg.EMPTY_BACKPACK="Empty",t.Msg.PASTE_ALL_FROM_BACKPACK="Paste All Blocks from Backpack",t.Msg.REMOVE_FROM_BACKPACK="Remove from Backpack";const e="backpack_open";class o extends t.Events.UiBase{constructor(t,o){super(o),this.isOpen=t,this.type=e}toJson(){const t=super.toJson();return t.isOpen=this.isOpen,t}fromJson(t){super.fromJson(t),this.isOpen=t.isOpen}}t.registry.register(t.registry.Type.EVENT,e,o);const i="backpack_change";class r extends t.Events.UiBase{constructor(t){super(t),this.type=i}}t.registry.register(t.registry.Type.EVENT,i,r);class c extends t.DragTarget{constructor(t,e){super(),this.workspace_=t,this.id="backpack",this.options_=function(t){const e={allowEmptyBackpackOpen:!0,contextMenu:{emptyBackpack:!0,removeFromBackpack:!0,copyToBackpack:!0,copyAllToBackpack:!1,pasteAllToBackpack:!1,disablePreconditionChecks:!1}};if(!t)return e;const o={};return o.contextMenu={...e.contextMenu,...t.contextMenu},o.allowEmptyBackpackOpen=t.allowEmptyBackpackOpen??e.allowEmptyBackpackOpen,o}(e),this.flyout_=null,this.contents_=[],this.boundEvents_=[],this.left_=0,this.top_=0,this.WIDTH_=40,this.HEIGHT_=60,this.MARGIN_VERTICAL_=20,this.MARGIN_HORIZONTAL_=20,this.HOTSPOT_MARGIN_=10,this.svgGroup_=null,this.SPRITE_TOP_=10,this.SPRITE_LEFT_=20,this.SPRITE_SIZE_=80}init(){var e,o;this.workspace_.getComponentManager().addComponent({component:this,weight:2,capabilities:[t.ComponentManager.Capability.AUTOHIDEABLE,t.ComponentManager.Capability.DRAG_TARGET,t.ComponentManager.Capability.POSITIONABLE]}),this.initFlyout_(),this.createDom_(),this.attachListeners_(),e=this.options_.contextMenu,o=this.workspace_,e.emptyBackpack&&function(e){const o=e.configureContextMenu;e.configureContextMenu=(s,n)=>{const i=e.getComponentManager().getComponent("backpack");if(!i||!i.getClientRect().contains(n.clientX,n.clientY))return void(o&&o.call(null,s,n));s.length=0;const r={text:t.Msg.EMPTY_BACKPACK,enabled:!!i.getCount(),callback:function(){i.empty()}};s.push(r)}}(o),e.removeFromBackpack&&function(){if(t.ContextMenuRegistry.registry.getItem("remove_from_backpack"))return;const e={displayText:t.Msg.REMOVE_FROM_BACKPACK,preconditionFn:function(t){const e=t.block.workspace;if(e.isFlyout&&e.targetWorkspace){const t=e.targetWorkspace.getComponentManager().getComponent("backpack");if(t&&t.getFlyout().getWorkspace().id===e.id)return"enabled"}return"hidden"},callback:function(t){t.block.workspace.targetWorkspace.getComponentManager().getComponent("backpack").removeBlock(t.block)},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"remove_from_backpack",weight:200};t.ContextMenuRegistry.registry.register(e)}(),e.copyToBackpack&&function(e){if(t.ContextMenuRegistry.registry.getItem("copy_to_backpack"))return;const o={displayText:function(e){if(!e.block)return;const o=e.block.workspace.getComponentManager().getComponent("backpack").getCount();return`${t.Msg.COPY_TO_BACKPACK} (${o})`},preconditionFn:function(t){const o=t.block.workspace;if(!o.isFlyout){const s=o.getComponentManager().getComponent("backpack");if(s)return e?"enabled":s.containsBlock(t.block)?"disabled":"enabled"}return"hidden"},callback:function(t){t.block.workspace.getComponentManager().getComponent("backpack").addBlock(t.block)},scopeType:t.ContextMenuRegistry.ScopeType.BLOCK,id:"copy_to_backpack",weight:200};t.ContextMenuRegistry.registry.register(o)}(e.disablePreconditionChecks),e.copyAllToBackpack&&function(){if(t.ContextMenuRegistry.registry.getItem("copy_all_to_backpack"))return;const e={displayText:t.Msg.COPY_ALL_TO_BACKPACK,preconditionFn:function(t){const e=t.workspace;return!e.isFlyout&&e.getComponentManager().getComponent("backpack")?"enabled":"hidden"},callback:function(t){const e=t.workspace;e.getComponentManager().getComponent("backpack").addBlocks(e.getTopBlocks())},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"copy_all_to_backpack",weight:200};t.ContextMenuRegistry.registry.register(e)}(),e.pasteAllToBackpack&&function(){if(t.ContextMenuRegistry.registry.getItem("paste_all_from_backpack"))return;const e={displayText:function(e){if(!e.workspace)return;const o=e.workspace.getComponentManager().getComponent("backpack").getCount();return`${t.Msg.PASTE_ALL_FROM_BACKPACK} (${o})`},preconditionFn:function(t){const e=t.workspace;return!e.isFlyout&&e.getComponentManager().getComponent("backpack")?"enabled":"hidden"},callback:function(e){const o=e.workspace;o.getComponentManager().getComponent("backpack").getContents().forEach((e=>{t.Xml.domToBlock(t.Xml.textToDom(e),o).scheduleSnapAndBump()}))},scopeType:t.ContextMenuRegistry.ScopeType.WORKSPACE,id:"paste_all_from_backpack",weight:200};t.ContextMenuRegistry.registry.register(e)}(),this.initialized_=!0,this.workspace_.resize()}dispose(){this.svgGroup_&&t.utils.dom.removeNode(this.svgGroup_);for(const e of this.boundEvents_)t.unbindEvent_(e);this.boundEvents_.length=0}initFlyout_(){const e=new t.Options({scrollbars:!0,parentWorkspace:this.workspace_,rtl:this.workspace_.RTL,oneBasedIndex:this.workspace_.options.oneBasedIndex,renderer:this.workspace_.options.renderer,rendererOverrides:this.workspace_.options.rendererOverrides,move:{scrollbars:!0}});if(this.workspace_.horizontalLayout){e.toolboxPosition=this.workspace_.toolboxPosition===t.utils.toolbox.Position.TOP?t.utils.toolbox.Position.BOTTOM:t.utils.toolbox.Position.TOP;const o=t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace_.options,!0);this.flyout_=new o(e)}else{e.toolboxPosition=this.workspace_.toolboxPosition===t.utils.toolbox.Position.RIGHT?t.utils.toolbox.Position.LEFT:t.utils.toolbox.Position.RIGHT;const o=t.registry.getClassFromOptions(t.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,this.workspace_.options,!0);this.flyout_=new o(e)}this.workspace_.getParentSvg().parentNode.appendChild(this.flyout_.createDom(t.utils.Svg.SVG)),this.flyout_.init(this.workspace_)}createDom_(){this.svgGroup_=t.utils.dom.createSvgElement(t.utils.Svg.G,{},null);const e=t.utils.genUid(),o=t.utils.dom.createSvgElement(t.utils.Svg.CLIPPATH,{id:"blocklyBackpackClipPath"+e},this.svgGroup_);t.utils.dom.createSvgElement(t.utils.Svg.RECT,{width:this.WIDTH_,height:this.HEIGHT_},o),this.svgImg_=t.utils.dom.createSvgElement(t.utils.Svg.IMAGE,{class:"blocklyBackpack","clip-path":"url(#blocklyBackpackClipPath"+e+")",width:this.SPRITE_SIZE_+"px",x:-this.SPRITE_LEFT_,height:this.SPRITE_SIZE_+"px",y:-this.SPRITE_TOP_},this.svgGroup_),this.svgImg_.setAttributeNS(t.utils.dom.XLINK_NS,"xlink:href",a),t.utils.dom.insertAfter(this.svgGroup_,this.workspace_.getBubbleCanvas())}attachListeners_(){this.addEvent_(this.svgGroup_,"mousedown",this,this.blockMouseDownWhenOpenable_),this.addEvent_(this.svgGroup_,"mouseup",this,this.onClick_),this.addEvent_(this.svgGroup_,"mouseover",this,this.onMouseOver_),this.addEvent_(this.svgGroup_,"mouseout",this,this.onMouseOut_)}addEvent_(e,o,s,n){const i=t.browserEvents.bind(e,o,s,n);this.boundEvents_.push(i)}getFlyout(){return this.flyout_}getClientRect(){if(!this.svgGroup_)return null;const e=this.svgGroup_.getBoundingClientRect(),o=e.top+this.SPRITE_TOP_-this.HOTSPOT_MARGIN_,s=o+this.HEIGHT_+2*this.HOTSPOT_MARGIN_,n=e.left+this.SPRITE_LEFT_-this.HOTSPOT_MARGIN_,i=n+this.WIDTH_+2*this.HOTSPOT_MARGIN_;return new t.utils.Rect(o,s,n,i)}getBoundingRectangle(){return new t.utils.Rect(this.top_,this.top_+this.HEIGHT_,this.left_,this.left_+this.WIDTH_)}position(e,o){if(!this.initialized_)return;const s=this.workspace_.scrollbar&&this.workspace_.scrollbar.canScrollHorizontally(),n=this.workspace_.scrollbar&&this.workspace_.scrollbar.canScrollVertically();e.toolboxMetrics.position===t.TOOLBOX_AT_LEFT||this.workspace_.horizontalLayout&&!this.workspace_.RTL?(this.left_=e.absoluteMetrics.left+e.viewMetrics.width-this.WIDTH_-this.MARGIN_HORIZONTAL_,s&&!this.workspace_.RTL&&(this.left_-=t.Scrollbar.scrollbarThickness)):(this.left_=this.MARGIN_HORIZONTAL_,s&&this.workspace_.RTL&&(this.left_+=t.Scrollbar.scrollbarThickness));const i=e.toolboxMetrics.position===t.TOOLBOX_AT_BOTTOM;i?(this.top_=e.absoluteMetrics.top+e.viewMetrics.height-this.HEIGHT_-this.MARGIN_VERTICAL_,n&&(this.top_-=t.Scrollbar.scrollbarThickness)):this.top_=e.absoluteMetrics.top+this.MARGIN_VERTICAL_;let r=this.getBoundingRectangle();for(let t,e=0;t=o[e];e++)r.intersects(t)&&(this.top_=i?t.top-this.HEIGHT_-this.MARGIN_VERTICAL_:t.bottom+this.MARGIN_VERTICAL_,r=this.getBoundingRectangle(),e=-1);this.svgGroup_.setAttribute("transform","translate("+this.left_+","+this.top_+")")}getCount(){return this.contents_.length}getContents(){return[...this.contents_]}onDrop(e){e instanceof t.BlockSvg&&this.addBlock(e)}blockToCleanXmlString_(e){return function(e){const o=e.cloneNode(!0);let s=o;for(;s;){s.removeAttribute&&(s.removeAttribute("x"),s.removeAttribute("y"),s.removeAttribute("id"),s.removeAttribute("disabled"),"comment"==s.nodeName&&(s.removeAttribute("h"),s.removeAttribute("w"),s.removeAttribute("pinned")));let t=s.firstChild||s.nextSibling;if(!t)for(t=s.parentNode;t;){if(t.nextSibling){t=t.nextSibling;break}t=t.parentNode}s=t}return t.Xml.domToText(o)}(t.Xml.blockToDom(e))}containsBlock(t){const e=this.blockToCleanXmlString_(t);return-1!==this.contents_.indexOf(e)}addBlock(t){this.addItem(this.blockToCleanXmlString_(t))}addBlocks(t){const e=t.map(this.blockToCleanXmlString_);this.addItems(e)}removeBlock(t){this.removeItem(this.blockToCleanXmlString_(t))}addItem(t){this.addItems([t])}addItems(t){const e=this.filterDuplicates_(t);e.length&&(this.contents_.unshift(...e),this.onContentChange_())}removeItem(t){const e=this.contents_.indexOf(t);-1!==e&&(this.contents_.splice(e,1),this.onContentChange_())}setContents(t){this.contents_=[],this.contents_=this.filterDuplicates_(t),this.onContentChange_()}empty(){this.getCount()&&(this.contents_.length&&(this.contents_=[],this.onContentChange_()),this.close())}onContentChange_(){this.maybeRefreshFlyoutContents_(),t.Events.fire(new r(this.workspace_.id))}filterDuplicates_(t){return t.filter(((e,o)=>t.indexOf(e)===o&&-1===this.contents_.indexOf(e)))}isOpenable_(){return!(this.isOpen()||!this.options_.allowEmptyBackpackOpen)||this.getCount()>0}isOpen(){return this.flyout_.isVisible()}open(){if(!this.isOpenable_())return;const e=this.contents_.map((e=>t.Xml.textToDom(e)));this.flyout_.show(e),t.Events.fire(new o(!0,this.workspace_.id))}maybeRefreshFlyoutContents_(){if(!this.isOpen())return;const e=this.contents_.map((e=>t.Xml.textToDom(e)));this.flyout_.show(e)}close(){this.isOpen()&&(this.flyout_.hide(),t.Events.fire(new o(!1,this.workspace_.id)))}autoHide(t){t||this.close()}onClick_(e){if(t.utils.isRightButton(e))return;this.open();const o=new(t.Events.get(t.Events.CLICK))(null,this.workspace_.id,"backpack");t.Events.fire(o)}onDragEnter(e){e instanceof t.BlockSvg&&this.updateHoverStying_(!0)}onDragExit(t){this.updateHoverStying_(!1)}onMouseOver_(){this.isOpenable_()&&this.updateHoverStying_(!0)}onMouseOut_(){this.updateHoverStying_(!1)}updateHoverStying_(e){const o="blocklyBackpackDarken";e?t.utils.dom.addClass(this.svgImg_,o):t.utils.dom.removeClass(this.svgImg_,o)}shouldPreventMove(e){return e instanceof t.BlockSvg}blockMouseDownWhenOpenable_(e){!t.utils.isRightButton(e)&&this.isOpenable_()&&e.stopPropagation()}}const a="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiM0NTVBNjQiPjxnPjxyZWN0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PGc+PHBhdGggZD0iTTEzLjk3LDUuMzRDMTMuOTgsNS4yMywxNCw1LjEyLDE0LDVjMC0xLjEtMC45LTItMi0ycy0yLDAuOS0yLDJjMCwwLjEyLDAuMDIsMC4yMywwLjAzLDAuMzRDNy42OSw2LjE1LDYsOC4zOCw2LDExdjggYzAsMS4xLDAuOSwyLDIsMmg4YzEuMSwwLDItMC45LDItMnYtOEMxOCw4LjM4LDE2LjMxLDYuMTUsMTMuOTcsNS4zNHogTTExLDVjMC0wLjU1LDAuNDUtMSwxLTFzMSwwLjQ1LDEsMSBjMCwwLjAzLTAuMDEsMC4wNi0wLjAyLDAuMDlDMTIuNjYsNS4wMywxMi4zNCw1LDEyLDVzLTAuNjYsMC4wMy0wLjk4LDAuMDlDMTEuMDEsNS4wNiwxMSw1LjAzLDExLDV6IE0xNiwxM3YxdjAuNSBjMCwwLjI4LTAuMjIsMC41LTAuNSwwLjVTMTUsMTQuNzgsMTUsMTQuNVYxNHYtMUg4di0xaDdoMVYxM3oiLz48L2c+PC9nPjwvc3ZnPg==";t.Css.register([".blocklyBackpack {\n    opacity: .4;\n  }\n  .blocklyBackpackDarken {\n    opacity: .6;\n  }\n  .blocklyBackpack:active {\n    opacity: .8;\n  }"])})(),n})()}));
//# sourceMappingURL=index.js.map